<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="mainText">
        
        <h1>Как структирровать хранение документов.</h1>
        <div>
            <p>
                Для эффективного использования MongoDB, следует уделить внимание структуре документов и коллекций.
                Можно хранить все данные в одной коллекции или разделить на несколько, используя ссылки на те или иные документы. 
                Всё зависит от нужд вашего приложения. Прежде чем разбираться с вопросом хранения данных, рассмотрим три вида структуры документа:
                
                <ol>
                    <li>NoSQL -- хранение в определённой коллекции документы, различающиеся по структуре и семантике</li>
                    <li>NoSQL + extra data -- хранение в определённой коллекции документы, имеющие одинаковые основные характеристики, но также допольнительные, присущие
                        только определённым сущностям
                    </li>
                    <li>SQL -- все документы имеют одинаковую структуру и семантику</li>
                </ol>
            </p>
            
        </div>
        <h2>Типы данных</h2>
        <div>
            <p>
                MongoDB имеет следующие типы данных:
                <ol>
                    <li>string</li>
                    <li>float</li>
                    <li>int32</li>
                    <li>int64</li>
                    <li>Date</li>
                    <li>Timestamp</li>
                    <li>ObjectId</li>
                    <li>boolean</li>
                    <li>arrays</li>
                    <li>embedded documents</li>
                </ol>
            </p>
        </div>

        <h2>Проектирование структуры БД и документов</h2>
        <div>
            Прежде, чем приступить к проектированию БД, стоит обратить внимание на следующие моменты:

            <ol>
                <li>С какими данными работает разрабатываемое приложение? -- Определяем ключи документа и как они относятся к другим документом</li>
                <li>В каких частях приложения нужны данные? (Меню, главная страница и т.д) -- 
                    Определяем коллекции, а также группируем ключи документов (например, как они ссылаются на другие документы)</li>
                <li>Какие именно данные нам нужны из БД? -- Определяем, какие запросы будем использовать</li>
                <li>Как часто будем читать данные? -- Определяем, как мы должны оптимизировать структуру документов для быстрого чтения</li>
                <li>Как часто будем записывать данные? -- Определяем, как мы должны оптимизировать структуру документов для быстрой записи/обновления</li>
            </ol>
        </div>

        <h2>Связи между документами</h2>
        <div>
            Имеем основные виды связей:
            <ol>
                <li>Один к одному</li>
                <li>Один ко многим</li>
                <li>Многие ко многим</li>
            </ol>
            
            Для представления данных в MongoDB есть следующие стратегии:
            <ol>
                <li>Использовать вложенный документ</li>
                <li>Использовать ссылки на другие документы</li>
            </ol>
        </div>

        <h3>Один к одному</h3>
        <div>
            Пример: у каждого футбольного клуба имеется один стадион и у каждого стадион имеется один владелец.
            Можно использовать вложенный документ и будет это выглядеть следующим образом:

            <div class="json">
                <br>{
                    <br>"_id" : "ManUtd",
                    <br>"name" : "Manchester United",
                    <br>"stadium" : "Old Trafford"
                <br>}
                
            </div>

            Иначе можно использовать допольнительную коллекцию, отражающая информацию о стадионах, а в коллекцию <i>footballClubs</i> значением ключа <i>stadium</i>
            будет <i>ObjectId</i> соответствующего стадиона
        </div>

        <h3>Один ко многим</h3>
        <div>
            Пример: у каждого футбольного клуба есть футболисты, но каждый футболист может играть только за один футбольный клуб.
            Если использовать вложенный документ, то документ будет выглядеть следующим образом:

            <div class="json">
                {
                    <br>    "_id" : "ManUtd",
                    <br>"name" : "Manchester United",
                    <br>"stadium" : ObjectId("61ffc45c0f1845416932fa20"),
                    <br>"squuad" : [
                    <br>{
                        <br>"name" : "Wayne",
                        <br>"lastname" : "Rooney",
                        <br>"position" : "forward"
                        <br>},
                        <br>{
                            <br>                            "name" : "David",
                            <br>"lastname" : "De Gea",
                            <br>"position" : "Goalkeeper"
                            <br>}
                            <br>]
                            <br>}
                
            </div>
            Или же, если мы используем коллекцию footballPlayers, для хранения футболистов, то можно в ключ squad документа из коллекции <i>footballClus</i> хранить 
            массив, состоящий из соответствующих ObjectId.
        </div>

        <h3>Многие ко многим</h3>
        <div>
            Пример: у каждого футбольного клуба могут быть несколько спонсоров, а у спонсоров -- несколько футбольных клубов, представляющие их.
            Вложенный документ:
            <div class="json">
               <br> {
                <br>"_id" : "ManUtd",
                <br>"name" : "Manchester United",
                <br>                    "stadium" : ObjectId("61ffc45c0f1845416932fa20"),
                <br>                    "squuad" : [
                <br>{
                    <br>"name" : "Wayne",
                    <br>"lastname" : "Rooney",
                    <br>"position" : "forward"
                    <br>                        },
                    <br>                        {
                        <br>"name" : "David",
                        <br>                            "lastname" : "De Gea",
                        <br>                            "position" : "Goalkeeper"
                        <br>}
                        <br>],
                        <br>"sponsors" : [
                        <br>{
                            <br>                            "title" : "Nike"
                            <br>},
                            <br>{
                                <br>"title" : "Adidas"
                                <br>}
                                <br>]
                                <br>}
                
            </div>

            Можно создать коллекцию <i>sponsors</i> и в ключе <i>sponsors</i> коллекции <i>footballClubs</i> усказать массив ObjectId соответствующих спонсоров.
        </div>

        <h2>Вложенный документ или допольнительная коллекция?</h2>
        <div>
            Каждый из подходов хорош под определённую ситуацию. Основные советы:
            <ol>
                <li>Один к одному 
                    <ol>
                        <li>Использовать вложенный документ, поскольку все данные находятся в одной коллекции, и велика вероятность отсутствия 
                            избыточности данных
                        </li>
                    </ol>
                </li>
                <li>Один ко многим 
                    <ol>
                        <li>
                            Использовать вложенный документ, если размер не будет превышать 16 мб.
                        </li>
                        <li>Использовать коллекцию, если во вложенном документе имеются данные, которые можно посчитать без коллекции, в которой он находится,
                            дабы уменьшить объём передаваемых данных
                        </li>
                    </ol>
                </li>
                <li>Многие ко многим 
                    <ol>
                        <li>
                           Использовать допольнительную коллекцию
                        </li>
                    </ol>
                </li>
            </ol>
        </div>
    </div>    
</body>