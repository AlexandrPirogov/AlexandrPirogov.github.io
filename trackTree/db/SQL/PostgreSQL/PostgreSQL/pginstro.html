<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>PostgreSQL. Введение</h1>

    <p>
        Основные концепции:
        <ol>
            <li>
                Отношения
            </li>
            <li>
                Кортежи
            </li>
            <li>
                Атрибуты
            </li>
            <li>
                Страницы -- структура данных хранящихся на вторичных устройствах.
            </li>
            <li>
                Буффер -- структура данных, которая хранит данные, считывающиеся со вторичного устройства.
            </li>
        </ol>
    </p>
    <p>
        <h2>Страницы</h2>
        Страница -- единица хранения данных.
        Каждое отношение и индекс хранятся как массив страниц фиксированного размера (обычно 8кб, можно изменить).
        Все страница эквивалетны в терминах размера и характеристик, то есть можно определить к какой странице относится кортеж (решение принимает сама БД).
        <br>
        <br>
        Страница состоит из:
        <ol>
            <li>Заголовка страница -- содержит информацию о странице (размер, свободное место в странице и т.д)</li>
            <li>Указатели на кортежи</li>
            <li>Сами кортежи</li>
            <li>Свободное место</li>
            <li>Специальное место -- хранится информация об индексах и другую информацию доступа.</li>
        </ol>
    </p>

    <p>
        <h2>PostMaster and memory architecture</h2>

        Архитектура разделяется на:
        <ol>
            <li>
                Процессы
            </li>
            <li>
                Буфферы
            </li>
            <li>
                Файлы
            </li>
        </ol>

        Файлы:
        <ol>
            <li>
                Physical Files -- хранят данные непосредствено
            </li>
            <li>
                Wal Files --  записываются все транзакции, прежде чем произойдет их фиксация (commit)
            </li>
            <li>
                Log Files -- записываются логи работы сервера
            </li>
            <li>
                coming soon...
            </li>
        </ol>

        Имеются следующие буфферы:
        <ol>
            <li>
                Shared buffer -- пользователь не может взаимодействовать с данными напрямую. Все операции данные происходят через shared buffer. 
                Данные, которы были изменены в Shared buffer называются dirty data.
                Dirty data записываются на диск за сценой Writer'ом.
            </li>
            <li>
                Wal buffer -- записывает метаданные об изменениях данных, которых достаточно для восстановления данных.
                Wal data записывается на диск в Wal Files, обычно называются "WAL segments" или "checkpoint segments".
                С помощью Wal Writer'a Wal data "удаляются из буфера" и записываются в Wal data.
            </li>
            <li>
                CLog buffer --  журна фиксаций, а буферы CLog -- область в RAM, предназначенная для хранения
                страниц журнала фиксации.
                Журналы фиксации содержат статус фиксации всех транзакций и указывают, была ли транзакция завершена (зафиксирована).

            </li>
            <li>
                Work memory -- это память, зарезервированная либо для одной сортировки, либо для хеш-таблицы.
            </li>
            <li>
                И другие...
            </li>
        </ol>
        Когда запускается PostgreSQL, самым первым начинает свою работу процесс Postmaster. Что он делает:?

        <ol>
            <li>Ожидает подключения от клиентов к PostgreSQL серверу.</li>
            <li>Ответственнен за аутентификацию и авторизацию клиента.</li>
            <li>Если клиент успешно проходит верификацию, создаёт новый процесс, который будет "работать с клиентом".</li>
            <li>Запускает/перезапускает остальные процесс (о них ниже).</li>
        </ol>


        Помимо основного Postmaster процесса имеются следующие процессы:
        <ol>
            <li>BgWriter/Writer -- записывает "грязные данные" из shared buffer в Data Files</li>
            <li>Wal Writer -- записывает данные из Wal Buffer в Wal files</li>
            <li>Checkpointer -- запускается каждые 5 минут или  когда превышен max_wal_size. Сигнализирует 
                writer'у, для записи грязных данных на диск, для синхронизации файлов. </li>
            <li>Logging Collector -- записывает ошибки в лог-файлы</li>
            <li>Stats Collector -- отвечает за сбор информации о работе сервера</li>
            <li>Auto Vacuum Launcher -- отвечает за операции на больших/разделенных таблицах</li>
        </ol>


    </p>
</body>
</html>