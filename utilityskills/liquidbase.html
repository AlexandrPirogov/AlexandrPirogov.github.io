<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/css/newstyle.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito">
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    
    <div class="routes">
        <div class="route">
            <h2><a href="/index.html">На главную</a></h2>
        </div>
    </div>
    <h1>
        LiquiBase
    </h1>
    <h1>
        Fundamentals concepts
    </h1>
    <div>
        <p>
            Liquibase использует команды и Change Types (типы вносимых изменений в схему БД) 
            которые позволяют определить, что вам нужно от LiquiBase и каким способом это должно быть сделано.
        </p>
        <p>
            Liquibase использует changelogs и tracking tables, чтобы определить, какие внесение были задеплоины в 
            БД после запущенной команды.
        </p>
    </div>
    <h2>
        Changelogs and Changesets
    </h2>
    <div>
        <p>
            Если вы хотите добавить или удалить изменения схемы в БД, вы записываете эти изменения в Changelog.
            Changelog -- просто текстовый файл изменений схемы, записанный в SQL, XML, YAML, JSON, они могут и должны быть
            сохранены в системе контроля версий.
            Changelog могут хранить другие Changelogи.
        </p>
        <p>
            Changelog состоит из Changesets -- единицы изменений схемы БД, состоящая из 
            команд изменений схемы. Лучшей практикой является ограничение каждого набора изменений только одним типом изменения.
        </p>
        <p>
            Используйте changelog'и для внесения изменений.
        </p>
    </div>

    <h2>
        Tracking Tables
    </h2>
    <div>
        <p>
            Tracking Tables (таблицы отслеживания) используются для отслеживания, версии и развертывания изменений схемы базы данных. 
            Если в вашей базе данных нет таблицы отслеживания, Liquibase создаст ее для вас.
        </p>
        <p>
            Имеется два вида Tracking Tables:
            <ol>
                <li>
                    Databasechangelog
                </li>
                <li>
                    Databasechangeloglock
                </li>
            </ol>
        </p>
        <p>
            Databasechangelog следит за каждым изменением с помощью ID, автора и файла, где расположены изменения.
        </p>
        <p>
            Databasechangeloglock гарантирует, что одновременно работает только один экземпляр Liquibase. 
            Он блокирует другие, чтобы предотвратить одновременное выполнение нескольких команд Liquibase, что может вызвать конфликты базы данных. 
            Это помогает предотвратить случайную перезапись ваших изменений другими разработчиками, администраторами баз данных или командами.
        </p>
    </div>
    <h2>
        Liquibase Commands
    </h2>
    <div>
        <p>
            <ol>
                <li>
                    update -- применяется ко всем невыполненным изменениям.
                </li>
                <li>
                    rollback -- возвращает (откатывает) изменения, внесенные вами в ваше БД.
                </li>
                <li>
                    snapshot -- используется, когда вы хотите быстро сравнить изменения в вашей БД или сохранить
                    запись о текущем состоянии вашей БД.
                </li>
                <li>
                    diff -- позволяет сравнивать две БД одного или разных типов друг с другом.
                </li>
                <li>
                    diff-changelog -- используется, когда вы хотите создать развертываемый журнал изменений 
                    для синхронизации нескольких БД.
                </li>
                <li>
                    history -- команда, которая выводит список всех ваших идентификаторов развертывания и 
                    всех наборов изменений, связанных с каждым идентификатором развертывания.
                </li>
            </ol>
        </p>
    </div>

    <h2>
        Configuring Liquibase properties
    </h2>
    <div>
        <p>
            liquidbase.properties -- текстовый файл, хранящий настройки, которые часто используются, но редко меняются, 
            как например, соединение к БД.
        </p>
        <p>
            Значения, указанные в терминале всегда переписывают значения в liquibase.properties.
        </p>
        <p>
            Различные команды требуют соответствующие им свойства, которые должны быть указаны. 
            Самый частые обязательные свойства:
            <ol>
                <li>
                    changelog-file -- включает путь до файла
                </li>
                <li>
                    url -- JDBC URL БД
                </li>
                <li>
                    username -- логин пользователя БД
                </li>
                <li>
                    пароль -- пароль пользователя БД
                </li>
                <li>
                    driver -- имя класса драйвера БД.
                </li>
            </ol>
        </p>
    </div>

    <h2>Developer WorkFlow</h2>
    <div>
        <p>
            Day to day process:
            <ol>
                <li>
                    Добавить changesets в changelog.
                </li>
                <li>
                    Убедиться в правильном создании changeset'a.
                </li>
                <li>
                    Сохранить changelog в системе контроля версии.
                </li>
                <li>
                    Запустить команду update.
                </li>
                <li>
                    Убедиться,что изменения произошли в БД.
                </li>
            </ol>
        </p>
        <h3>Убедиться, что изменения произошли в БД</h3>
        <p>
            <ol>
                <li>
                    Запустите <b>run command</b>, чтобы увидеть список задеплоенных изменений.
                </li>
                <li>
                    Запустите <b>status command</b>, чтобы увидеть незадеплоенных изменений.
                </li>
                <li>
                    Запустите <b>diff command</b> между двумя БД, чтобы увидеть, есть ли незапланированные изменения.
                    Вы можете запустить <b>diff command</b> чтобы удостовериться, что изменения были применены к БД 
                    или обнаружить  расхождение между схемой модели и фактической схемой базы данных.
                </li>
            </ol>
        </p>

        <h2>generateChangeLog Command</h2>
        <p>
            Команда generateChangeLog создает файл журнала изменений с 
            последовательностью наборов изменений, описывающих Liquibase, как 
            воссоздать текущее состояние исходной базы данных. Обычно он используется 
            при наличии существующей базы данных, но Liquibase ранее не использовался. Это помогает синхронизировать обе базы данных и использовать одну и ту же схему.

            Команда generateChangeLog не создает новую базу данных или схему, 
            она просто создает копию существующей базы данных.
        </p>
        <p>
            Чтобы запустить, введите <b>./liquibase --changeLogFile=dbchangelog.postgresql.xml generateChangeLog</b>
        </p>

        <h2>Snapshot Command</h2>
        <p>
            Команда моментального снимка обычно используется, 
            когда вы хотите быстро сравнить изменения в вашей базе данных или сохранить запись о текущем состоянии вашей базы данных. Моментальный снимок похож на фотографию вашей базы данных, 
            которую можно использовать в команде diff или команде diffChangeLog.
        </p>
        <p>
            Uses:
            <ol>
                <li>
                    При запуске без параметров он соберет текущее состояние базы данных и покажет текстовую версию схемы в STDOUT.
                </li>
                <li>
                    При запуске с параметром --snapshotFormat=yaml создается вывод на основе yaml, представляющий текущее состояние вашей базы данных. (При желании вы можете выбрать вывод на основе JSON, используя параметр --snapshotFormat=json).
                </li>
            </ol>
            Snapshot'ы можно сравнить с
            <ol>
                <li>
                    Предыдущее состоянии БД к текущему
                </li>
                <li>
                    Предыдущее состояние БД к другому Snapshot'y
                </li>
            </ol>
        </p>
        <p>
            Запустить команду: <b>liquibase --outputFile=myschemaSnapshot.yaml snapshot --snapshotFormat=yaml</b>
        </p>

        <h2>Diff Command</h2>
        <p>
            Команда diff позволяет сравнивать две схемы базы данных 
            одного или разных типов друг с другом. Обычно он используется по завершении 
            проекта для проверки того, что изменения были применены к базе данных, или для обнаружения расхождений между 
            схемой модели и фактической схемой базы данных.
        </p>
        <p>
            Используйте diff:
            <ol>
                <li>
                    Чтобы найти недостающие объекты между двумя БД.
                </li>
                <li>
                    Чтобы увидеть, как изменения сделано для БД.
                </li>
            </ol>
        </p>
        <p>
            Запустить команду: <b>liquibase --outputFile=mydiff.txt diff</b>
        </p>
        <p>
            Diff Command создаст лист категорий и описаний:
            <ol>
                <li>
                    <b>Missing</b> -- объекты, которые есть в source db (referenceUrl in liquibase.properties file),
                    но не в target db (url in liquibase.properties)
                </li>
                <li>
                    <b>Unexpected</b> -- объекты, которые есть в target db (url in liquibase.properties file),
                    но не в source db (referenceUrl in liquibase.properties)
                </li>
                <li>
                    <b>Changed</b> -- объекты, которые есть в target db 
                    (url in liquibase.properties file),
                    есть в source db (referenceUrl in liquibase.properties), но они отличаются друг от друга.
                </li>
            </ol>
        </p>
        <h2>The diffChangeLog Command</h2>
        <p>
            Команда diffChangeLog создает файл журнала изменений, содержащий развертываемые наборы изменений, но Liquibase определяет, 
            какие наборы изменений должны быть основаны на сравнении двух указанных баз данных.
        </p>
        <p>
            Эта команда полезна при синхронизации нескольких баз данных. Он предоставит дополнительную информацию по трем основным направлениям:
            <ol>
                <li>
                    Найти недостающие объекты в БД.
                </li>
                <li>
                    Увидеть изменения сделанные в БД.
                </li>
            </ol>
        </p> 
        <p>
            Запустить команду: <b>liquibase --changeLogFile=file_name.databaseappend.sql diffChangeLog</b>
        </p>

        <h2>Rollback Command</h2>
        <p>
            Liquibase позволяет отменить изменения в базе данных с помощью команд отката. 
            Команды отката будут последовательно отменять изменения, которые 
            были развернуты до указанной точки, такой как дата или количество изменений.
        </p>
        <p>
            <ol>
                <li>
                   <b>rollbackToDate &ltdate&gt</b> — возвращает вашу базу данных в состояние, в котором она была на дату и время, указанные вами.
                </li>
                <li>
                   <b>rollbackCount &ltcount&gt</b> — отменяет указанное количество наборов изменений, где <значение> — это количество наборов изменений, которые вы хотите последовательно отменить в своей базе данных. Ограничения по количеству нет.
                </li>
                <li>
                   <b>rollback &lttagname&gt</b> - отменить все изменения, сделанные в базе данных на основе указанного тега.
                </li>
            </ol>
        </p>
    </div>
</body>
</html>